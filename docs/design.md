# subsync 設計メモ（概要）

## 目的

- YouTube 動画に対して、日本語字幕（翻訳済み）を Web 上で同期表示できるプレイヤーを提供する。
- 将来的には URL を入力するだけで、字幕取得〜変換〜永続化〜再利用までを一気通貫で扱えるサービスにする。

---

## フェーズ構成

### フェーズ1: 単一ページ + ローカル JSON 字幕

- 固定の YouTube 動画を 1 本扱う。
- 字幕データはローカルの JSON を用意して読み込む。
- YouTube IFrame Player API から `currentTime` を取得し、JSON の `start` / `end` と突き合わせて字幕を同期表示する。
- SRT → JSON 変換は、アプリ外で手動/スクリプトで実施する前提（アプリ内にはまだ実装しない）。
- バックエンドや DB は登場せず、フロント側のみで完結させる。

### フェーズ2: フロントエンド設計の精緻化

- フェーズ1で動かした最小構成を、拡張可能な設計にリファクタリングする。
- 動画・字幕・トラックなどのドメインモデルを整理し、型レベルで明示する。
- 再生状態（currentTime, duration, 再生/一時停止など）と、動画・字幕データ（Video, SubtitleTrack など）の責務を分離する。
- 字幕や動画データの取得方法を抽象化し、将来バックエンド/API に差し替えられるようにしておく。

### フェーズ3: バックエンド連携（URL 入力 → 処理 → 表示）

- フロントで YouTube の URL を入力すると、バックエンドが処理を行う流れを作る。
- バックエンド側の主な責務:
  - URL から動画 ID を抽出する。
  - 必要な字幕/SRT を取得し、アプリが扱いやすい JSON 形式に変換する。
  - クライアントが扱う動画情報・字幕トラック情報をまとめて返す。
- フロント側は、バックエンド API を通じて「動画 + 字幕 JSON」を取得し、フェーズ2で設計した構造に流し込んで表示する。
- 字幕データ取得の実装を「ローカル JSON ベース」から「API ベース」に切り替え/共存できるようにする。

### フェーズ4: 永続化（DB）

- バックエンドにデータベースを導入し、動画と字幕データを保存する。
- 主な対象:
  - 動画情報（動画 ID, タイトル, URL など）
  - 字幕トラック情報（言語、種別）
  - 字幕行情報（start/end, 原文/訳文テキストなど）
- URL を処理するエンドポイントは、字幕生成後に DB に保存するように拡張する。
- フロントからは、過去に保存した動画/字幕を取得して再利用できるようにする。

### フェーズ5: デプロイ & Docker 化

- フロントエンド、バックエンド、データベースを Docker コンテナとして構築する。
- `docker-compose` でローカル開発環境と本番環境の差を小さく保ちながら運用できるようにする。
- 本番向けには、ビルド済みフロントエンド、バックエンド API、DB を一体としてデプロイし、実務レベルで運用可能な形に仕上げる。

---

## 技術スタック（想定・概要）

- フロントエンド:
  - React + TypeScript
  - YouTube IFrame Player API を用いた再生時間の取得と同期制御
- バックエンド:
  - API サーバー（言語・FW は別途詳細設計）
  - YouTube URL 解析、字幕取得、SRT→JSON 変換などの処理を担当
- データベース:
  - RDB（例: PostgreSQL）などを想定
  - 動画・字幕トラック・字幕行を永続化する。

---

## このドキュメントの位置づけ

- あくまで「フェーズごとの設計方針と役割分担」の概要メモ。
- フロントエンドの具体的なコンポーネント構成やコード設計は、別途自分で検討・記述する。
